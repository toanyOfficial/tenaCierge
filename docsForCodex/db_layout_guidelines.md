# DB 레이아웃 변경 커뮤니케이션 가이드

## 기본 원칙
- **실 DB 우선**: 스키마는 항상 실제 DB 상태를 기준으로 삼습니다. 코드/문서가 오래된 경우에도, 우선 실제 DB를 조회하여 반영합니다.
- **자동 재설계 금지**: 요청된 로직이 현 스키마와 맞지 않아도 임의로 테이블 구조를 재설계하지 않습니다. 불일치나 제약 사항을 발견하면 바로 사용자에게 알립니다.
- **변경 통지**: 스키마 차이(테이블/컬럼 누락, 타입 불일치, 제약 조건 변경)를 발견하면 변경 내역과 영향을 명확히 요약해 공유합니다.

## 작업 플로우
1. **스키마 동기화**
   - 가능하면 작업 전 **실제 DB 접속 정보**를 받아 `docsForCodex/schema.csv`를 재생성합니다.
   - DB 접속 정보를 받을 수 없거나 네트워크가 제한된 환경이라면, 제공된 최신 `schema.csv`를 그대로 사용하고 "실 DB 교차 검증 불가" 사실을 먼저 알립니다.
   - 스키마 참조가 필요한 기능은 코드 내에서 **schema.csv**를 우선 사용하되, 런타임에서 실 DB 메타데이터와 교차 검증합니다. 교차 검증이 불가한 경우 로그/코멘트로 명시합니다.

2. **차이 탐지 시 알림**
   - 조회 중 다음을 발견하면 즉시 보고합니다:
     - 테이블/컬럼 누락 또는 이름 변경
     - 데이터 타입/널 제약 상이
     - 인덱스·제약 조건 추가/삭제
   - 보고 형식(예시):
     - 영향 기능: 정산 스냅샷 조회
     - 발견 위치: `client_additional_price.amount` 컬럼 누락
     - 현상/위험: 정산 합계 산출 실패 가능
     - 제안: 실제 DB에 컬럼 추가 또는 로직에서 컬럼 가드 적용

3. **방어적 구현**
   - 메타데이터 스캔 실패나 스키마 미스매치 시:
     - 기능을 중단하지 않고, 누락 항목을 스킵하거나 기본값/가드를 적용
     - 경고 로그(예: `etc_errorLogs`)에 원인, 대상 테이블/컬럼, 요청 ID를 기록

4. **재요청 흐름**
   - 스키마 불일치로 인해 요구 기능을 완전히 구현하기 어려울 경우:
     - 현재 가능한 부분과 불가능한 부분을 구분해 설명
     - 필요한 스키마 변경 사항을 제안하고 사용자 확인 후 재시도합니다.

## 커뮤니케이션 체크리스트
- [ ] 실 DB 기준으로 스키마 확인 완료
- [ ] `schema.csv` 최신화 여부 확인
- [ ] 발견한 스키마 차이와 영향, 대응 방안 보고
- [ ] 기능이 완전/부분 구현 상태인지 명시
- [ ] 추가 요청/변경 필요한 사항 사용자에게 재확인
