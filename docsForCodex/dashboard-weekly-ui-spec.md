# 대시보드 - 주간업무 UI 명세

대시보드-주간업무 화면을 구성하는 주요 레이아웃과 데이터 동기화 주기, 시간 기반 디자인 전환 규칙을 정리한다.

## 컴포넌트 정의

### 1. 요약 그리드 (Summary Grid)
- **역할**: 요일별 총 건수와 섹터별 건수 패턴을 표시한다.
- **업데이트 주기**: 매일 09:00, 15:00, 16:30에 세 번 데이터가 갱신된다.
- **시간별 디자인 변경내용**: 시간에 따른 디자인 변경은 없다.
- **상태 기반 색상 규칙** (role=1 클리너 슬롯 기준):
  - 해당 일자의 `work_apply` 슬롯 중 `role=1`인 행이 **모두 채워져 있고 빈 슬롯이 없으면**(클리너 신청 완료) 폰트 색상 **Blue**.
  - 해당 일자의 `work_apply` 슬롯 중 `role=1`인 행이 **모두 비어 있고 한 건도 배정되지 않았으면** 폰트 색상 **Red**.
  - 해당 일자의 `work_apply` 슬롯 중 `role=1` 행이 없거나, 신청 정보가 있는 행과 없는 행이 혼재하면 기본 폰트 색상 **White** 유지.
- **기타**: 날짜는 `YYYY-MM-DD(요일)` 형태로 표시하며, 섹터 건수는 `/` 구분자로 합산된다.

### 2. D0 업무 진행 카드 (Today Work Card)
- **역할**: 당일 진행 중인 섹터·건물별 배정/청소/검수 상태를 스택형 막대와 호실 카드로 보여준다.
- **업데이트 주기**: 실시간으로 표시되며 10분마다 데이터 스냅샷을 재요청한다. 레이아웃 모드는 1분 간격으로 현재 시각을 확인해 자동 동기화한다.
- **시간별 디자인 변경내용**:
  - 15:30 이전에는 이 카드가 우선 레이아웃(`todayDominant`)으로 넓게 표시된다.
  - 15:30 이후에는 자동으로 축소(`compactCard`)되며, D+1 카드가 확장된다. 사용자가 토글 버튼으로 수동 전환할 수 있고, 1분마다 시각을 재검사해 자동 동기화를 유지한다.
  - 축소 상태(`tomorrowDominant`)에서는 컴팩트 리스트 + 페이징 UI로 대체된다. 컴팩트 리스트는 한 페이지에 들어가는 행 수를 컨테이너 높이로 계산하고, 여러 페이지일 경우 1분마다 자동 순환한다.
- **기타**:
  - 호실 상태 단계는 `배`(배정 여부), `담`(담당자 배정 및 노쇼 감지), `청`(청소 진행률), `검`(검수 여부)로 표시하며 색상 클래스는 단계별 플래그로 결정된다.
  - D0 카드가 확장된 상태에서는 섹터·건물별 스택형 진행 바와 최대 36개의 호실 카드(비어 있으면 플레이스홀더)를 보여준다.

### 3. D+1 준비 현황 카드 (Tomorrow Prep Card)
- **역할**: 익일 예약된 섹터·건물별 총량 대비 완료 수, 그리고 예약/배치 목록을 보여주는 배치 모니터링 카드.
- **업데이트 주기**: 매일 09:00, 15:00, 16:30에 세 번 데이터가 갱신된다.
- **시간별 디자인 변경내용**:
  - 15:30 이후 기본 레이아웃에서 이 카드가 확장(`dominantCard`)되고 D0 카드가 축소된다.
  - 15:30 이전에는 축소(`compactCard`) 상태로 표시된다. 크기 외의 스타일 변화는 없다.
- **기타**: 진행 바에는 섹터별 진행률 마커와 건물별 색상 세그먼트가 표시되며, 예약/배치 리스트는 상태 배지와 함께 세로로 나열된다.

#### 3.1. D+1 - dominant
- 섹터별 전체 `work` 건수와 `apply` 슬롯 현황을 보여준다.
- role 구분이 필수다.

#### 3.2. D+1 - compact
- 섹터별, 건물별, 체크아웃 시각별 `work` 건수와 `apply` 슬롯 현황을 보여준다.
- role 구분이 필수다.

### 4. 컴팩트 섹터 요약 (Compact Sector Summary)
- **역할**: 축소 레이아웃에서 진행 중인 섹터별 건수를 텍스트 라인으로 나열해 빠르게 파악하도록 돕는다.
- **업데이트 주기**: D0 카드와 동일하게 10분마다 새 스냅샷을 수신하며, 자동 페이징 로직도 동일하게 적용된다.
- **시간별 디자인 변경내용**: 레이아웃이 `tomorrowDominant`일 때만 노출된다.
- **기타**: 진행 중인 호실이 없으면 “오늘 하루도 수고하셨습니다.” 메시지가 나타난다.

### 5. 레이아웃 토글 버튼
- **역할**: 사용자가 D0 우선(8:2) / D+1 우선(2:8) 뷰를 수동으로 전환할 수 있는 플로팅 버튼.
- **업데이트 주기**: 버튼 자체는 고정이지만, 클릭 시 상태가 즉시 전환된다. 자동 동기화 타이머는 매 분 현재 시각을 체크해 15:30 기준 기본 모드를 재적용한다.
- **시간별 디자인 변경내용**: 버튼 레이블은 ‘D+1가 넓게 보기 (8:2)’ 또는 ‘D0가 넓게 보기 (2:8)’으로 현재 상태에 맞춰 변경된다.
- **기타**: 레이아웃 모드는 상태 기반이라 새로고침 시에도 15:30 기준 규칙을 따라 초기화된다.

## 데이터 스냅샷 구성요소
- **Summary**: 요일·날짜별 섹터 건수 배열.
- **todayProgress / tomorrowProgress**: 섹터 코드·이름, 건물별 총량/완료 수로 구성된 진행률 데이터.
- **roomStatuses**: 섹터, 건물, 호실, 배정/청소/검수 플래그, 소유주 정보를 포함한다.
- **tomorrowApply**: 익일 예약/배치 행(제목, 부제, 상태 배지).
- **capturedAt**: 현재 스냅샷의 기준 시각으로, 요약·D0·D+1 카드 모두 동일하게 사용된다.

## 구현/수정 작업 리스트 (최신 명세 대비)
아래 스텝들은 최신 명세와 현재 로직을 비교해 도출한 추가 구현·수정 항목들이다. 각 스텝마다 Title, dscpt, 작업항목, 진행상태를 명시한다.

### Step 1: 요약 그리드 리프레시/색상 로직 정합성 확인
- **dscpt**: 요약 그리드가 09:00/15:00/16:30에만 새로고침되고 role=1 슬롯 상태에 따라 Blue/Red/White 색상을 정확히 반영하는지 검증·보완한다.
- **작업항목**:
  - API/스케줄러가 세 타임스탬프에 맞춰 요약 데이터(섹터 건수·날짜)를 재수집하는지 확인하고 필요 시 트리거를 수정한다.
  - work_apply role=1 행이 모두 배정/미배정/혼재/미존재인 케이스별로 렌더 결과 색상이 Blue/Red/White로 나오는지 테스트하고 뷰 로직을 보완한다.
  - 적용 후 스냅샷 기준 시각(`capturedAt`)이 표시 영역과 일치하는지 확인한다.
- **진행상태**: DONE

### Step 2: D+1 카드 데이터 분리 및 리프레시 정렬
- **dscpt**: D+1 카드(dominant/compact)가 09:00/15:00/16:30 리프레시에 맞춰 role 구분이 유지된 work/apply 집계를 보여주도록 데이터 파이프라인과 뷰를 점검한다.
- **작업항목**:
  - role 필터가 dominant(섹터 전체)와 compact(섹터·건물·체크아웃 시각별) 데이터셋에 모두 적용되는지 확인한다.
  - 세 타임스탬프 리프레시 시 todayProgress/tomorrowProgress/tomorrowApply가 동일한 capturedAt으로 갱신되는지 검증한다.
  - 갱신 주기를 프론트엔드 폴링/백엔드 배치와 맞춰서 동일 시간에 스냅샷이 반영되도록 조정한다.
- **진행상태**: DONE

### Step 3: 15:30 자동 레이아웃 전환 및 수동 토글 동기화
- **dscpt**: 15:30 이후 D+1이 확장되고 D0가 축소되는 기본 모드 전환이 자동/수동 모두 안정적으로 동작하도록 타이머·상태 동기화를 확인한다.
- **작업항목**:
  - 분 단위 시각 체크 로직이 15:30을 기준으로 기본 레이아웃을 재적용하는지 검증한다.
  - 사용자가 토글 버튼으로 상태를 바꾼 뒤에도 다음 분 동기화에서 규칙이 올바르게 반영되는지 확인하고, 필요 시 수동 유지 기간을 정의한다.
  - 축소 모드에서 컴팩트 리스트 페이징 및 자동 순환이 정상 동작하는지 시나리오 테스트를 추가한다.
- **메모**: 수동 토글 시 5분간 유지 후 분 단위 동기화 타이머에서 기본 모드로 복원한다. 축소 모드 진입 시 페이징을 첫 페이지로 리셋하고, 한 페이지씩 1분 간격 자동 순환한다.
- **진행상태**: DONE

### Step 4: D0 실시간 스냅샷 및 호실 카드 표시 안정화
- **dscpt**: D0 카드의 10분 주기 데이터 재요청, 최대 36개 호실 카드/플레이스홀더 표시, 단계별 색상 클래스 적용이 명세와 일치하는지 점검한다.
- **작업항목**:
  - 10분 스냅샷 타이머와 1분 레이아웃 동기화가 충돌 없이 병행되는지 확인한다.
  - 배/담/청/검 플래그별 색상 클래스 매핑이 최신 디자인 토큰과 일치하는지 검증한다.
  - 호실 데이터가 부족할 때 플레이스홀더가 렌더되고, 오버플로우 시 페이징/순환 처리되는지 테스트한다.
- **진행상태**: DONE

### Step 5: 컴팩트 섹터 요약 및 빈 상태 메시지 처리
- **dscpt**: tomorrowDominant 모드에서 컴팩트 섹터 요약이 자동 페이징되며 진행 중 호실이 없을 때 종료 메시지를 노출하도록 로직을 확정한다.
- **작업항목**:
  - 페이징 단위 계산(컨테이너 높이 기반)과 자동 순환 주기를 검증한다.
  - roomStatuses가 비어 있을 때 “오늘 하루도 수고하셨습니다.” 메시지가 노출되고 레이아웃이 깨지지 않는지 확인한다.
  - D+1 확장 모드 전환 시 페이징 타이머 초기화/재시작 동작을 정의한다.
- **진행상태**: DONE (컴팩트 섹터 라인이 컨테이너 높이 기반으로 페이지당 행 수를 계산해 1분 간격 순환하며, 진행 중 호실이 없을 경우 섹터 요약/호실 리스트 모두 종료 메시지를 노출하고 tomorrowDominant 진입 시 페이징을 0페이지로 초기화하도록 반영함)
