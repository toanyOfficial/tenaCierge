# Step9 마무리 · 웹 푸시 구축 리캡 및 Go/No-Go 체크리스트

본 문서는 단계별 작업(0~8) 완료 후, 실제 개발/배포로 넘어가기 전 마지막 점검과 후속 액션을 정리한다.

## 1) 완료 요약 (Step0~8)
- **스키마/시드 정리**: `push_subscription` 제약(UNIQUE endpoint/type/user), `notify_jobs` outbox+`push_message_logs` 로깅 구조, 템플릿 id 1~6 고정 시드 계획 수립.
- **공통 유틸**: 전화번호 정규화(`010xxxxxxxx`), dedup_key 포맷 상수, VAPID 환경 변수(`VAPID_*`/`NEXT_PUBLIC_VAPID_PUBLIC_KEY`) 로딩, UPSERT 헬퍼/DAO 설계.
- **구독 API**: `/api/push/subscribe` 계약서와 CLIENT/WORKER 분기, UPSERT 로직, enabled_yn 리셋, 메타데이터 갱신 규칙 정의.
- **프론트/서비스워커**: 로그인 직후 동의 배너 UX, SW 등록/푸시 핸들러, 구독 payload 전송/재시도 플로우, 필요한 env/권한 안내 정리.
- **발송 파이프라인**: notify_jobs 상태 전이(READY→LOCKED→DONE/FAILED), 재시도/백오프, push_message_logs 기록, pluggable deliver 함수 규약.
- **6개 시나리오 큐잉**: 일정/배정/배정해제/마무리/소모품/업무신청별 대상 조회, 메시지/템플릿, dedup_key 정의.
- **테스트 계획(Step7)**: 단위/통합/시나리오/프런트 수동 테스트 및 성능 체크 목록, 실행 명령과 완료 기준.
- **운영 런북(Step8)**: 모니터링 지표, 알람 기준, 운영 토글, 장애 대응, 배포·롤백 절차와 사전 준비 체크리스트.

## 2) Go/No-Go 체크리스트 (실행 전 필수 확인)
- **환경 변수**: `VAPID_PUBLIC_KEY`, `VAPID_PRIVATE_KEY`, `VAPID_SUBJECT`, `NEXT_PUBLIC_VAPID_PUBLIC_KEY` 모두 설정·배포 준비.
- **스키마/인덱스**: `push_subscription` UNIQUE, `notify_jobs`/`push_message_logs` 필수 컬럼·인덱스 적용 여부 확인(DDL 반영/마이그레이션 완료).
- **템플릿 시드**: id 1~6 존재 확인(없으면 UPSERT 시드 실행) 및 메시지 콘텐츠 검증.
- **Worker 배치**: notify_jobs 워커 실행 스케줄/프로세스 준비, 동시성/재시도 설정값 검증.
- **보안/도메인**: 서비스워커 scope와 웹 앱 도메인 일치, HTTPS 환경, 푸시 아이콘/클릭 URL 유효성 확인.
- **관측/알람**: 로그/메트릭 대시보드 생성, 실패율·VAPID 오류 알람 룰 배포.
- **롤백 준비**: 발송 전역 on/off 토글, 워커 중지 방법, SW 등록 해제 안내 플랜 확보.

## 3) 남은 리스크/의존성
- **VAPID 키 미배포**: 키 미설정 시 워커 초기화 실패 → 사전 배포 필수.
- **템플릿 미시드**: id 충돌/미존재 시 시나리오 큐잉 실패 → 시드 스크립트 실행 필요.
- **데이터 정합성**: phone 정규화 누락된 기존 데이터와의 매칭 문제 → 구독 재동의 캠페인 또는 백필 검토.
- **브라우저 권한 거부**: 반복 안내 UX는 있지만 opt-in 전환률 불확실 → 퍼널 모니터링 및 카피/타이밍 A/B 필요.
- **프런트 배포 순서**: 서비스워커/배너 코드 미배포 상태에서 워커만 켜면 대상 부족 → 프런트 선배포 권장.

## 4) 바로 실행할 다음 액션
- [ ] 스키마/시드 마이그레이션 적용 확인(`push_templates` 1~6 포함).
- [ ] `.env(.local)` 및 배포 환경에 VAPID/클라이언트 키 설정 후 CI/CD 시크릿 반영.
- [ ] 프런트(Service Worker+배너) 배포 → 구독 API 확인 → 워커 프로세스 기동 순으로 점진 활성화.
- [ ] 테스트 플랜(Step7) 표에 따라 단위/통합/시나리오/프런트 수동 테스트 실행 및 기록.
- [ ] 운영 대시보드·알람 룰 점검 후 Go 신호 시 시나리오별 단계적 활성화.

## 5) 커뮤니케이션/승인 메시지 템플릿 (예시)
- **Go 요청**: "웹 푸시 모듈 Step0~8 준비 완료. VAPID/스키마/시드/프런트 배포 확인했습니다. 테스트 플랜 실행 후 워커 켭니다. 진행 승인 부탁드립니다."
- **No-Go 대응**: "현재 VAPID 키/템플릿 시드/프런트 배포 중 하나 이상 미완료로 Go 보류. 체크리스트 충족 후 재요청하겠습니다."
